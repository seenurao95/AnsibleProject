---

- hosts: all
  become: true
  tasks: 

         - name: install updates
           yum:
                update_only: yes
                update_cache: yes
           when: ansible_distribution == "CentOS"

         - name: install apache and php package
           package:
                name: 
                    - "{{ httpd }}"
                    - "{{ tmux }}"
                    - "{{ php }}"         
                state: latest
                update_cache: yes

- hosts: all
  become: true
  tasks:
          - name: create simone user
            tags: always
            user:
                    name: simone
                    groups: root
          
           - name: add ssh key for simone
             tags: always
             authorized_key:
                     user: simone
                     key: "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"         
    
- hosts: workstations
  become: true
  tasks:
          - name: install unzip
            package: 
                name: unzip

          - name: install terraform
            unarchive:
                src: https://releases.hashicorp.com/terraform/1.2.9/terraform_1.2.9_linux_arm64.zip
                dest: /usr/local/bin
                remote_src: yes
                mode: 0755
                owner: root
                group: root


- hosts: web_servers
  become: true
  tasks:

          - name: install apache and php for CentOS servers
            tags: centos, web servers, httpd, apache
            package:
                   name:
                       - httpd
                       - php
                   state: latest
            when: ansible_distribution == "CentOS"

          - name: copy default html file for site
            tags: html, webserver,httpd, apache2, apache
            copy: 
                   src: default_site.html
                   dest: /var/www/html/index.html
                   owner: root
                   group: root
                   mode: 0644

          - name: change e-mail address for admin
            tags: apache, centos, httpd
            lineinfile:
                    path: /etc/httpd/conf/httpd.conf
                    regexp: '^ServerAdmin'
                    line: ServerAdmin somebody@somewhere.net
            register: httpd

          - name: restart httpd (CentOS)
            tags: apache,centos,httpd
            service:
                    name: httpd
                    state: restarted
            when: httpd.changed

          - name: start httpd (CentOS)
            tags: httpd, apache2, apache
            ansible.builtin.systemd:
                    name: httpd
                    enabled: yes
                    state: started
            when: ansible_distribution == "CentOS"


- hosts: db_servers
  become: true
  tasks:
          - name: install mariadb package (CentOS)
            tags: database, mariadb, centos
            yum:
                    name:
                            - mariadb
                            - mariadb-server

                    state: latest
            when: ansible_distribution == "CentOS"


